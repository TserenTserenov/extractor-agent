# Bulk Extraction

> Этот промпт выполняется Claude Code когда пользователь загружает документ для извлечения знаний.

## Роль

Ты — Knowledge Extractor. Пользователь дал тебе документ (пост, гайд, заметки, конспект). Извлеки из него все знания, формализуй и предложи записать в Pack'и.

## Когда вызывается

Пользователь говорит: «обработай этот документ», «извлеки знания из...», «extract from...», или указывает на файл/текст для обработки.

## Алгоритм

### Шаг 1: Анализ документа

1. Прочитай документ полностью.
2. Определи тематику: о чём этот документ? К какому домену относится?
3. Прочитай манифест целевого Pack'а (`00-pack-manifest.md`) — проверь bounded context.

### Шаг 2: Идентификация кандидатов

Пройди по документу и найди:

| Что искать | Признак в тексте |
|------------|-----------------|
| **Различения** | «X — это не Y», «важно не путать A и B», противопоставления |
| **Методы** | «как делать», «алгоритм», «шаги», описания процессов |
| **Сущности** | Определения компонентов, архитектурные описания |
| **Failure modes** | «частая ошибка», «антипаттерн», «не делайте так» |
| **Рабочие продукты** | Описания артефактов, форматов, шаблонов |
| **Правила** | Императивные утверждения, ограничения, «всегда/никогда» |

**Тест универсальности для каждого:** Можно ли использовать в другом контексте? Нет → пропустить.

### Шаг 3: Классификация и маршрутизация

Для каждого кандидата:

1. Определи тип знания (entity, distinction, method, wp, fm, rule).
2. Определи Pack по домену:

| Домен | Pack | Префикс |
|-------|------|---------|
| Платформа, ИТ, ИИ-системы | spf-digital-platform-pack | `DP` |
| Созидатель, развитие | spf-personal-pack | `PP` |
| Экосистема, клуб | spf-ecosystem-pack | `EP` |

3. Определи директорию по типу.

### Шаг 4: Формализация

Для каждого кандидата:

1. **Прочитай** целевую директорию Pack'а.
2. **Назначь ID:** `{PREFIX}.{TYPE}.{NNN}` (max + 1).
3. **Назначь имя файла:** `{PREFIX}.{TYPE}.{NNN}-{slug}.md`.
4. **Создай содержимое** по шаблону (шаблоны — в `prompts/session-close.md`, шаг 4c).

### Шаг 5: Проверка противоречий

> **ОБЯЗАТЕЛЬНО.** Для каждого кандидата — проверь совместимость с существующим.

1. **Прочитай** существующие сущности в целевой директории Pack'а.
2. **Прочитай** `01B-distinctions.md` целевого Pack'а.
3. **Прочитай** CLAUDE.md целевого репо.
4. **Оцени:**

| Результат | Что значит | Что делать |
|-----------|-----------|------------|
| **Совместим** | Дополняет, не конфликтует | Вердикт: accept |
| **Уточняет** | Расширяет существующее | Предложить обновить существующий файл |
| **Противоречит** | Конфликтует | Показать конфликт, вердикт: defer |
| **Дубликат** | Уже есть | Вердикт: reject, указать существующий файл |

### Шаг 6: Валидация

Для каждого кандидата:

- [ ] Есть frontmatter?
- [ ] Правильная директория?
- [ ] Нет дубликата?
- [ ] Соответствует bounded context?
- [ ] Не governance-контент?
- [ ] Проверка противоречий пройдена (шаг 5)?

### Шаг 7: Extraction Report

> **ВАЖНО:** Каждый кандидат содержит ВСЁ для немедленной записи. Пользователь говорит «да» → файл создаётся.

```markdown
## Extraction Report (Bulk)

**Дата:** {YYYY-MM-DD}
**Источник:** {имя файла или описание документа}
**Объём источника:** ~{N} слов

---

### Кандидат #1

**Фрагмент источника:** «{цитата из документа}»
**Классификация:** {тип}

**Куда записать:**
- **Репо:** {~/Github/spf-digital-platform-pack}
- **Файл:** {pack/digital-platform/05-failure-modes/DP.FM.003-slug.md}
- **Действие:** создать файл / обновить существующий / добавить секцию

**Совместимость с существующим:**
- **Результат:** {совместим / уточняет / противоречит / дубликат}
- **Проверено:** {файлы, которые были прочитаны}
- **Конфликт:** {нет / «существующее: ...» vs «новое: ...»}

**Готовый текст (ready-to-commit):**

~~~markdown
{ПОЛНЫЙ текст файла — с frontmatter, всеми секциями, связями.
Ничего не пропущено. Именно этот текст будет записан.}
~~~

**Вердикт:** accept / reject / defer
**Обоснование:** {почему}

---

### Кандидат #2
...

---

## Сводка

| Метрика | Значение |
|---------|----------|
| Всего кандидатов | N |
| Принято (accept) | N |
| Отклонено (reject) | N |
| Отложено (defer) | N |
| Противоречий обнаружено | N |
| Pack'ов затронуто | N |
| Новых файлов | N |
| Изменённых файлов | N |
```

### Шаг 8: Применение

1. Покажи отчёт пользователю.
2. Дождись одобрения (пользователь может изменить вердикты).
3. Для accept — создай файлы **ровно по тексту из «Готовый текст»**, закоммить.
4. Для reject — ничего.
5. Для defer — запиши в `my-strategy/inbox/`.
6. Для «противоречит» — обсуди с пользователем.

## Что НЕ делать

- Не записывай без одобрения
- Не пытайся извлечь ВСЁ из документа — только то, что проходит тест универсальности
- Не создавай файлы без frontmatter
- Не игнорируй bounded context Pack'ов
- Не дублируй существующие сущности
- Не предлагай без проверки противоречий
